# FIX Protocol Trade Executor (FIXNA)

![CI Status](https://github.com/YOUR_USERNAME/YOUR_REPOSITORY/actions/workflows/python-app.yml/badge.svg)

## Overview/Description

FIXNA (FIX NATIVE Application) is a Python-based application designed to connect to a Financial Information eXchange (FIX) protocol API for trade execution. It manages FIX sessions, sends trade orders, processes execution reports, and handles order cancellations. The application is configurable through an INI file and provides comprehensive logging.

## Features

*   Connects to a FIX server using TCP/IP.
*   Handles core FIX session management messages:
    *   Logon (35=A)
    *   Logout (35=5)
    *   Heartbeat (35=0)
    *   TestRequest (35=1)
    *   ResendRequest (35=2) (basic handling)
    *   SequenceReset (35=4) (Reset and GapFill modes)
*   Sends `NewOrderSingle` (35=D) messages for Market and Limit orders.
*   Receives and processes `ExecutionReport` (35=8) messages to track order status.
*   Sends `OrderCancelRequest` (35=F) and handles `OrderCancelReject` (35=9) messages.
*   SSL/TLS encryption for secure communication (configurable).
*   Persistent storage of FIX sequence numbers across sessions.
*   Highly configurable via an INI file (`config/config.ini`).
*   Comprehensive logging to both console and a specified log file.
*   Unit tests for core components (`AppSettings`, `FixClient`, `TradeExecutor`).

## Project Structure

The project is organized into the following main directories:

*   `src/`: Contains the core application logic.
    *   `main.py`: The main entry point for the application.
    *   `fix_client.py`: Manages FIX connectivity, session handling, and message transport.
    *   `trade_executor.py`: Handles order creation, sending, and processing of execution reports.
    *   `logger_setup.py`: Configures logging for the application.
    *   `utils.py`: (If present) Utility functions.
*   `config/`: Contains configuration files.
    *   `settings.py`: Loads and manages application settings from the INI file.
    *   `config.example.ini`: An example configuration file.
    *   `config.ini`: The actual configuration file used by the application (user-created from the example).
*   `tests/`: Contains unit tests for the application.
    *   `test_settings.py`: Tests for configuration loading.
    *   `test_fix_client.py`: Tests for FIX client logic.
    *   `test_trade_executor.py`: Tests for trade execution logic.
*   `logs/`: (This directory is typically created by the application) Contains log files generated by the application, as specified in `config.ini`.

## Prerequisites

*   Python 3.x (Python 3.8 or higher is recommended, as specified in `pyproject.toml`).
*   Poetry: A tool for dependency management and packaging in Python.

## Setup & Installation

1.  **Clone the Repository:**
    (If applicable, otherwise skip this step if you have the source code directly)
    ```bash
    git clone <repository_url>
    cd fixna-trading-app 
    ```

2.  **Install Poetry:**
    If you don't have Poetry installed, you can install it by following the official instructions at [https://python-poetry.org/docs/#installation](https://python-poetry.org/docs/#installation).
    A common method is:
    ```bash
    pip install poetry
    ```
    Or, for a more isolated installation:
    ```bash
    curl -sSL https://install.python-poetry.org | python3 -
    ```
    Ensure Poetry's bin directory is in your system's PATH.

3.  **Install Project Dependencies:**
    Navigate to the project root directory (where `pyproject.toml` is located) and run:
    ```bash
    poetry install
    ```
    This will create a virtual environment (if one doesn't exist for the project) and install all dependencies, including `simplefix`.

4.  **Set Up Configuration:**
    The application requires a `config.ini` file to run.
    *   Navigate to the `config/` directory.
    *   Copy the example configuration file:
        ```bash
        cp config.example.ini config.ini
        ```
    *   Edit `config/config.ini` with your specific FIX server details and preferences. Key fields include:
        *   `[FIX_SERVER]`: `Host`, `Port`, `SenderCompID`, `TargetCompID`, `HeartbeatIntervalSeconds`, SSL settings, and sequence number file path (see "Configuration Details" below).
        *   `[ACCOUNT]`: `Username`, `Password` (these might be optional depending on your FIX server's requirements).
        *   `[APPLICATION]`: `LogLevel`, `LogFile`.
    *   The application will attempt to create directories for log files and sequence number files if they do not exist, but ensure appropriate write permissions for the application's runtime environment.

## Running the Application

To start the FIXNA trading application using Poetry's managed environment:

```bash
poetry run python -m src.main
```
Alternatively, you can activate the virtual environment first and then run the application:
```bash
poetry shell
python -m src.main
# exit (to deactivate the shell)
```

**Note:** Ensure that a FIX server is running, accessible from the machine where you run the application, and that your `config.ini` settings match the server's requirements.

### Resetting Sequence Numbers

To reset FIX sequence numbers to 1 for both incoming and outgoing messages, you can start the application with the `RESET_SEQNUM` environment variable set to `true`:

```bash
RESET_SEQNUM=true poetry run python -m src.main
```
This will send the `ResetSeqNumFlag(141)=Y` in the Logon message and update the persistent sequence number file accordingly. Use this with caution and only when coordinated with your FIX counterparty.

## Running Tests

To discover and run all unit tests located in the `tests/` directory using Poetry:

```bash
poetry run python -m unittest discover -s tests
```
You can also run individual test files:
```bash
poetry run python -m unittest tests.test_fix_client 
# or
poetry run python tests/test_fix_client.py
```

## Configuration Details (`config.ini`)

The `config.ini` file is structured into sections:

*   **`[FIX_SERVER]`**:
    *   `Host`: IP address or hostname of the FIX server.
    *   `Port`: Port number for the FIX server connection.
    *   `SenderCompID`: Your FIX SenderCompID.
    *   `TargetCompID`: The FIX server's TargetCompID.
    *   `HeartbeatIntervalSeconds`: The heartbeat interval (in seconds) to be proposed to the server during Logon. The server may override this.
    *   **SSL/TLS Configuration:**
        *   `UseSSL`: Set to `true` to enable SSL/TLS encryption for the FIX connection, or `false` (default) for a plain TCP connection.
        *   `CACertFile`: (Optional) Path to the Certificate Authority (CA) certificate file (e.g., `/path/to/ca.pem`). If provided, the server's certificate will be verified against this CA.
        *   `ClientCertFile`: (Optional) Path to the client's SSL certificate file (e.g., `/path/to/client_cert.pem`). Used for client-side authentication if required by the server.
        *   `ClientKeyFile`: (Optional) Path to the client's SSL private key file (e.g., `/path/to/client_key.key`). Must be provided if `ClientCertFile` is used.
        *   *Paths can be absolute or relative to the project root.*
    *   **Sequence Number Configuration:**
        *   `SeqNumFilePath`: Path to the file where incoming and outgoing sequence numbers will be stored (e.g., `data/sequence_numbers.dat`). Default is `data/sequence_numbers.dat`.
        *   The application loads sequence numbers from this file at startup and saves the latest numbers upon graceful disconnection or when a sequence reset is performed.
        *   The directory for this file (e.g., `data/`) will be created automatically if it doesn't exist.

*   **`[ACCOUNT]`**:
    *   `Username`: Username for FIX session authentication (if required by the server).
    *   `Password`: Password for FIX session authentication (if required by the server).
    *   *Note: These fields are optional and their necessity depends on the FIX server's security configuration.*

*   **`[APPLICATION]`**:
    *   `LogLevel`: The logging level for the application. Valid values include `DEBUG`, `INFO`, `WARNING`, `ERROR`, `CRITICAL`.
    *   `LogFile`: Path to the log file (e.g., `logs/app.log`). If relative, it's typically relative to the project root. The directory will be created if it doesn't exist.

## Logging

*   The application logs messages to both the console (stdout) and a log file.
*   The log file path and logging verbosity are configured in `config.ini` under the `[APPLICATION]` section (`LogFile` and `LogLevel` respectively).
*   **Log Levels:**
    *   `DEBUG`: Very detailed information, typically of interest only when diagnosing problems.
    *   `INFO`: Confirmation that things are working as expected.
    *   `WARNING`: An indication that something unexpected happened, or indicative of some problem in the near future (e.g., ‘disk space low’). The software is still working as expected.
    *   `ERROR`: Due to a more serious problem, the software has not been able to perform some function.
    *   `CRITICAL`: A serious error, indicating that the program itself may be unable to continue running.
*   The log format includes a timestamp, logger name, log level, module name, and the log message.

## Future Enhancements (Potential)

*   **Automatic Reconnection:** Implement robust logic for automatically reconnecting if the FIX session drops.
*   **More Advanced Order Types:** Support for other order types beyond Market and Limit (e.g., Stop, StopLimit).
*   **Order Modification:** Implement `OrderCancelReplaceRequest` (35=G).
*   **Expanded FIX Message Support:** Handle a wider range of administrative and application-level FIX messages.
*   **GUI Interface:** A graphical user interface for easier interaction.
*   **Database Integration:** Store trades, configurations, or logs in a database.

---
*This README provides an overview of the FIXNA application. Refer to the source code and configuration files for more detailed information.*
